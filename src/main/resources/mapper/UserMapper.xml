<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--一定要写对-->
<mapper namespace="com.work.work.mapper.UserMapper">
    <!--根据用户账号名称获取用户-->
    <select id="getUserByAccount"
            resultType="com.work.work.entity.User">
        select * from wn_user where account = #{account}
    </select>

    <!--根据手机号获取用户-->
    <select id="getUserByPhone"
            resultType="com.work.work.entity.User">
        select * from wn_user where telphone = #{phone} limit 1
    </select>
    
    <!--根据手机号获取所有用户（可能有多个）-->
    <select id="getUsersByPhone"
            resultType="com.work.work.entity.User">
        select * from wn_user where telphone = #{phone}
    </select>
    
    <!--检查手机号是否存在-->
    <select id="checkPhoneExists" resultType="boolean">
        select count(*) > 0 from wn_user where telphone = #{phone}
    </select>

    <!--根据邮箱获取用户-->
    <select id="getUserByEmail"
            resultType="com.work.work.entity.User">
        select * from wn_user where email = #{email}
    </select>

    <!--注册-->
    <insert id="insert" parameterType="com.work.work.entity.User">
        INSERT INTO wn_user (account, password, telphone,
                             email, money, points, avatar, reg_time, status, nickname)
        VALUES (#{account}, #{password}, #{telphone}, #{email}, #{money}, #{points}, #{avatar}, #{regTime}, #{status}, #{nickname})
    </insert>

    <!--更新用户信息-->
    <update id="updateUser" parameterType="com.work.work.entity.User">
        UPDATE wn_user
        <set>
            <if test="account != null">account = #{account},</if>
            <if test="telphone != null">telphone = #{telphone},</if>
            <if test="email != null">email = #{email},</if>
            <if test="nickname != null">nickname = #{nickname},</if>
            <if test="avatar != null">avatar = #{avatar},</if>
            <if test="status != null">status = #{status},</if>
        </set>
        WHERE id = #{id}
    </update>

    <!--更新密码-->
    <update id="updatePassword">
        UPDATE wn_user SET password = #{newPassword} WHERE id = #{id}
    </update>

    <!--更新头像-->
    <update id="updateAvatar">
        UPDATE wn_user SET avatar = #{avatar} WHERE id = #{id}
    </update>

    <!--更新昵称-->
    <update id="updateNickname">
        UPDATE wn_user SET nickname = #{nickname} WHERE id = #{id}
    </update>

    <!--更新手机号-->
    <update id="updatePhone">
        UPDATE wn_user SET telphone = #{phone} WHERE id = #{id}
    </update>

    <!--更新邮箱-->
    <update id="updateEmail">
        UPDATE wn_user SET email = #{email} WHERE id = #{id}
    </update>
</mapper>